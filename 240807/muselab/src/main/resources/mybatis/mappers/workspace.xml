<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.muse.lab.dao.WorkspaceDAO">
	<resultMap id="workspaceResult" type="MuseLabVO">
		<!-- user -->
		<result property="userId" column="user_id" />
		<result property="userPwd" column="user_pwd" />
		<result property="userPhone" column="user_phone" />
		<result property="userEmail" column="user_email" />
		<result property="userNickname" column="user_nickname" />
		<result property="userProfile" column="user_profile" />
		<result property="userInfo" column="user_info" />
		<result property="userAddress" column="user_address" />
		<result property="userGrade" column="user_grade" />
		<result property="userBank" column="user_bank" />
		<result property="userAccount" column="user_account" />
		
		<!-- music -->
		<result property="musicId" column="music_id" />
		<result property="musicTitle" column="music_title" />
		<result property="musicInfo" column="music_info" />
		<result property="musicGenre" column="music_genre" />
		<result property="musicAlbum" column="music_album" />
		<result property="musicDate" column="music_date" />
		<result property="musicFile" column="music_file" />
		<result property="musicImage" column="music_image" />
		<result property="musicViews" column="music_views" />
		
		<!-- music comment -->
		<result property="musicCommentId" column="music_comment_id" />
		<result property="musicCommentContent" column="music_comment_content" />
		<result property="musicCommentDate" column="music_comment_date" />
		
		<!-- music like -->
		<result property="musicLikeId" column="music_like_id" />
		
		<!-- playlist -->
		<result property="playlistId" column="playlist_id" />
		<result property="playlistFolder" column="playlist_folder" />

		<!-- commuity -->
		<result property="communityId" column="community_id" />
		<result property="communityCategory" column="community_category" />
		<result property="communityTitle" column="community_title" />
		<result property="communityContent" column="community_content" />
		<result property="communityDate" column="community_date" />
		<result property="communityImage1" column="community_image1" />
		<result property="communityImage2" column="community_image2" />
		<result property="communityImage3" column="community_image3" />
		<result property="communityImage4" column="community_image4" />
		<result property="communityImage5" column="community_image5" />
		<result property="communityViews" column="community_views" />

		<!-- commuity comment -->
		<result property="commCommentId" column="comm_comment_id" />
		<result property="commCommentContent" column="comm_comment_content" />
		<result property="commCommentDate" column="comm_comment_date" />

		<!-- commuity like -->
		<result property="commLikeId" column="comm_like_id" />

		<!-- market -->
		<result property="marketId" column="market_id" />
		<result property="marketTitle" column="market_title" />
		<result property="marketContent" column="market_content" />
		<result property="marketImage1" column="market_image1" />
		<result property="marketImage2" column="market_image2" />
		<result property="marketImage3" column="market_image3" />
		<result property="marketImage4" column="market_image4" />
		<result property="marketImage5" column="market_image5" />
		<result property="marketPrice" column="market_price" />
		<result property="marketCategory" column="market_category" />
		<result property="marketViews" column="market_views" />
		<result property="marketStock" column="market_stock" />
		<result property="marketStatus" column="market_status" />

		<!-- market comment -->
		<result property="mkReviewId" column="mk_review_id" />
		<result property="mkReviewContent" column="mk_review_content" />
		<result property="mkReviewDate" column="mk_review_date" />
		<result property="mkReviewScore" column="mk_review_score" />

		<!-- market like -->
		<result property="mkLikeId" column="mk_like_id" />

		<!-- user msg -->
		<result property="userMsgId" column="user_msg_id" />
		<result property="userMsgTitle" column="user_msg_title" />
		<result property="userMsgContent" column="user_msg_content" />
		<result property="userMsgDate" column="user_msg_date" />

		<!-- notice -->
		<result property="noticeId" column="notice_id" />
		<result property="noticeTitle" column="notice_title" />
		<result property="noticeContent" column="notice_content" />
		<result property="noticeImage1" column="notice_image1" />
		<result property="noticeImage2" column="notice_image2" />
		<result property="noticeImage3" column="notice_image3" />
		<result property="noticeImage4" column="notice_image4" />
		<result property="noticeImage5" column="notice_image5" />
		<result property="noticeViews" column="notice_views" />
	
		<!-- operation -->
		<result property="operationId" column="operation_id" />
		
		<!-- event -->
		<result property="eventId" column="event_id" />
		
		<!-- article -->
		<result property="articleId" column="article_id" />
		<result property="articleTitle" column="article_title" />
		<result property="articleContent" column="article_content" />
		<result property="articleImage1" column="article_image1" />
		<result property="articleImage2" column="article_image2" />
		<result property="articleImage3" column="article_image3" />
		<result property="articleImage4" column="article_image4" />
		<result property="articleImage5" column="article_image5" />
		<result property="articleViews" column="article_views" />

		<!-- ad -->
		<result property="adId" column="ad_id" />
		<result property="adTitle" column="ad_title" />
		<result property="adStart" column="ad_start" />
		<result property="adEnd" column="ad_end" />
		<result property="adImage" column="ad_image" />
		<result property="adMemo" column="ad_memo" />
		<result property="adPosition" column="ad_position" />

		<!-- buy -->
		<result property="buyId" column="buy_id" />
		<result property="orderId" column="order_id" />
		<result property="buyCount" column="buy_count" />
		<result property="buyStatus" column="buy_status" />
		<result property="buyDate" column="buy_date" />
		
		<!-- admin -->
		<result property="adminId" column="admin_id" />
		<result property="adminPwd" column="admin_pwd" />
		<result property="adminName" column="admin_name" />		
	</resultMap>

	<!-- 목록 출력 -->
	<select id="workspaceList" parameterType="MuseLabVO" resultType="MuseLabVO" resultMap="workspaceResult">
		SELECT *
		FROM music
		ORDER BY music_date DESC
	</select>

	<!-- 상세 보기 -->
	<select id="workspaceDetail" parameterType="MuseLabVO" resultType="MuseLabVO" resultMap="workspaceResult">
		SELECT *
		FROM music
		WHERE music_id = #{musicId}
	</select>
	
	<!-- 글쓰기 -->
	<insert id="workspaceWrite" parameterType="MuseLabVO">
		INSERT INTO music(music_title,music_info,music_genre,music_album,music_date,music_file,music_image,music_user,music_views)
		VALUES (#{musicTitle}, #{musicInfo}, #{musicGenre}, #{musicAlbum}, current_timestamp(), #{musicFile}, #{musicImage}, #{userId}, 0);
	</insert>
	
	<!-- 글 수정 -->
	<update id="workspaceMod" parameterType="MuseLabVO">
		UPDATE music SET music_title = #{musicTitle}, music_info = #{musicInfo}, music_genre = #{musicGenre}, music_album = #{musicAlbum}, music_file = #{musicFile}, music_image = #{musicImage} 
		WHERE music_user = #{userId} AND music_id = #{musicId}
	</update>
	
	<!-- 글 삭제 -->
	<delete id="workspaceDel" parameterType="MuseLabVO">
		DELETE FROM music 
		WHERE music_user = #{userId} AND music_id = #{musicId}
	</delete>
	
	<!-- 조회수 증가 -->
	<update id="musicViewPlus">
		UPDATE music
		SET music_views = music_views + 1
		WHERE music_id = #{musicId}
	</update>
	
	<!-- 좋아요 추가 -->
	<insert id="musicLikeInsert" parameterType="MuseLabVO">
		INSERT INTO music_like(music_like_user, music_like_music)
		SELECT #{userId},#{musicId} from dual
		WHERE NOT EXISTS
		(SELECT * FROM music_like WHERE music_like_user=#{userId} AND music_like_music=#{musicId});
	</insert>
	
	<!-- 좋아요 삭제 -->
	<delete id="musicLikeDel" parameterType="MuseLabVO">
		DELETE FROM music_like 
		WHERE music_like_user=#{userId} AND music_like_music=#{musicId};
	</delete>

	<!-- 좋아요 수 확인 -->
	<select id="musicLikeCnt" parameterType="String" resultType="int" resultMap="workspaceResult">
		SELECT count(*) as musicLikeCnt
		FROM music_like 
		WHERE music_like_music = #{musicId}
	</select>
	
	<!-- 댓글 추가 -->
	<insert id="musicCommentInsert" parameterType="MuseLabVO">
	INSERT INTO music_comment (music_comment_content, music_comment_date,music_comment_music, music_comment_user)
	VALUES(#{musicCommentContent}, current_timestamp(), #{musicId}, #{userId})
	</insert>
	
	<!-- 댓글 수정 -->
	<update id="musicCommentMod" parameterType="MuseLabVO">
	UPDATE music_comment SET music_comment_content = #{musicCommentContent} 
	WHERE music_comment_id = #{musicCommentId} and music_comment_user = #{userId}
	</update>
	
	<!-- 댓글 삭제 -->
	<delete id="musicCommentDel" parameterType="MuseLabVO">
	DELETE FROM music_comment WHERE music_comment_id = #{musicCommentId} and music_comment_user = #{userId}
	</delete>
	
	
</mapper>